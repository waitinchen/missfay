# 🧪 本地测试指南

## 测试时间
2026-01-03

## 测试步骤

### 步骤 1: 确认服务运行

**检查端口占用**:
```powershell
netstat -ano | findstr "8000"
```

**如果端口未占用，启动服务**:
```powershell
.\start_voice_bridge.ps1
```

### 步骤 2: 运行自动化测试

**执行测试脚本**:
```powershell
python 本地测试脚本.py
```

**测试项目**:
1. ✅ 健康检查端点 (`/health`)
2. ✅ 前端界面 (`/`)
3. ✅ 静态文件 (`/static/phi_chat.html`)
4. ✅ 聊天端点 (`/chat`)
5. ✅ TTS 端点 (`/tts`)

### 步骤 3: 手动浏览器测试

**访问界面**:
1. 打开浏览器
2. 访问: http://localhost:8000/
3. 检查界面是否正常加载

**检查健康监控**:
- 右上角应显示: `LLM: OK  TTS: OK`
- 如果显示错误，检查后端日志

**测试对话**:
1. 在输入框输入测试消息
2. 点击发送
3. 等待回复和语音生成
4. 检查是否有错误提示

### 步骤 4: 验证功能

**验证项**:
- [ ] 界面正常加载
- [ ] 健康监控显示正常
- [ ] 可以发送消息
- [ ] 收到文字回复
- [ ] 语音自动播放
- [ ] 没有 401 错误
- [ ] 没有其他错误提示

## 预期结果

### 成功指标

1. **健康检查**: 返回 200，显示 `brain_status: ready`, `cartesia_status: ready`
2. **前端界面**: 正常加载，显示聊天界面
3. **聊天功能**: 可以发送消息，收到回复和语音
4. **健康监控**: 显示 `LLM: OK  TTS: OK`

### 常见问题

**问题 1: 连接失败**
- 检查服务是否运行
- 检查端口 8000 是否被占用
- 检查防火墙设置

**问题 2: 401 错误**
- 检查 API Key 是否有效
- 运行 `comprehensive_key_health_check.py` 验证 Key
- 检查 `.env` 文件是否正确加载

**问题 3: 语音不播放**
- 检查浏览器音频权限
- 检查浏览器控制台是否有错误
- 检查后端日志

**问题 4: 回复超时**
- 检查 Gemini API 是否正常
- 检查网络连接
- 增加超时时间

## 测试报告

测试完成后，查看测试脚本输出的结果。

---

**测试脚本**: `本地测试脚本.py`  
**状态**: 等待测试执行


